<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Donga Atta - Telugu Fun Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --accent-primary: #e94560;
            --accent-green: #00d4aa;
            --accent-gold: #ffc107;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --text-muted: #6c6c7c;
            --border-color: #2a2a4a;
            --gradient-primary: linear-gradient(135deg, #e94560 0%, #7b2cbf 100%);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .app { max-width: 480px; margin: 0 auto; min-height: 100vh; padding: 20px; }
        .screen { display: none; flex-direction: column; min-height: calc(100vh - 40px); animation: fadeIn 0.3s; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .header { text-align: center; padding: 20px 0 30px; }
        .logo { font-size: 2.5rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .tagline { color: var(--text-secondary); font-size: 0.9rem; }
        .btn { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 16px 24px; border: none; border-radius: 16px; font-family: inherit; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; transition: all 0.3s; }
        .btn-primary { background: var(--gradient-primary); color: white; box-shadow: 0 4px 20px rgba(233,69,96,0.3); }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--bg-card); color: white; border: 1px solid var(--border-color); }
        .btn-outline { background: transparent; color: var(--accent-primary); border: 2px solid var(--accent-primary); }
        .card { background: var(--bg-card); border-radius: 20px; padding: 24px; margin-bottom: 16px; border: 1px solid var(--border-color); }
        .card-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .mode-card { cursor: pointer; position: relative; transition: all 0.3s; }
        .mode-card:hover { border-color: var(--accent-primary); }
        .mode-card::after { content: '‚Üí'; position: absolute; right: 24px; top: 50%; transform: translateY(-50%); font-size: 1.5rem; color: var(--text-muted); }
        .mode-description { color: var(--text-secondary); font-size: 0.85rem; margin-top: 8px; }
        .input-field { width: 100%; padding: 14px 18px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 12px; color: white; font-family: inherit; font-size: 1rem; }
        .input-field:focus { outline: none; border-color: var(--accent-primary); }
        .player-list { display: flex; flex-direction: column; gap: 10px; max-height: 250px; overflow-y: auto; }
        .player-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-secondary); border-radius: 12px; animation: slideIn 0.3s; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .player-num { width: 28px; height: 28px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; }
        .player-name { flex: 1; font-weight: 500; }
        .player-remove { width: 28px; height: 28px; background: transparent; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.2rem; border-radius: 50%; }
        .player-remove:hover { color: var(--accent-primary); background: rgba(233,69,96,0.1); }
        .category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .category-item { padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 14px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .category-item:hover { border-color: var(--accent-primary); transform: translateY(-2px); }
        .category-item.selected { border-color: var(--accent-primary); background: rgba(233,69,96,0.1); }
        .category-emoji { font-size: 2rem; margin-bottom: 8px; }
        .category-name { font-size: 0.85rem; font-weight: 500; }
        .setting-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid var(--border-color); }
        .setting-row:last-child { border-bottom: none; }
        .toggle { position: relative; width: 52px; height: 28px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 28px; transition: 0.3s; }
        .toggle-slider::before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background: white; border-radius: 50%; transition: 0.3s; }
        .toggle input:checked + .toggle-slider { background: var(--accent-primary); border-color: var(--accent-primary); }
        .toggle input:checked + .toggle-slider::before { transform: translateX(24px); }
        .number-selector { display: flex; align-items: center; gap: 12px; }
        .number-btn { width: 36px; height: 36px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 10px; color: white; font-size: 1.2rem; cursor: pointer; }
        .number-btn:hover { border-color: var(--accent-primary); color: var(--accent-primary); }
        .number-value { font-size: 1.3rem; font-weight: 600; min-width: 40px; text-align: center; }
        .select-field { width: 100%; padding: 14px 18px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 12px; color: white; font-family: inherit; font-size: 1rem; cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23a0a0b0' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; }
        .select-field:focus { outline: none; border-color: var(--accent-primary); }
        .select-field option { background: var(--bg-card); }
        .info-box { background: rgba(233,69,96,0.1); border: 1px solid rgba(233,69,96,0.3); border-radius: 12px; padding: 14px 16px; margin-top: 12px; font-size: 0.85rem; color: var(--text-secondary); }
        .reveal-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .reveal-player { font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 10px; }
        .reveal-name { font-size: 2rem; font-weight: 700; margin-bottom: 30px; }
        .reveal-card { width: 100%; max-width: 280px; aspect-ratio: 3/4; background: var(--gradient-primary); border-radius: 24px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.5s; transform-style: preserve-3d; position: relative; box-shadow: 0 10px 40px rgba(233,69,96,0.3); }
        .reveal-card.flipped { transform: rotateY(180deg); }
        .reveal-card-front, .reveal-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 24px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px; }
        .reveal-card-front { background: var(--gradient-primary); }
        .reveal-card-back { background: var(--bg-card); transform: rotateY(180deg); border: 3px solid var(--accent-primary); }
        .reveal-tap-icon { font-size: 3rem; margin-bottom: 20px; }
        .reveal-tap-text { font-size: 1.2rem; font-weight: 600; }
        .reveal-role { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 2px; }
        .reveal-word { font-size: 2rem; font-weight: 700; }
        .reveal-word.imposter { color: var(--accent-primary); }
        .reveal-category { font-size: 0.85rem; color: var(--text-muted); margin-top: 16px; }
        .turn-dots { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .turn-dot { width: 12px; height: 12px; border-radius: 50%; background: var(--border-color); }
        .turn-dot.active { background: var(--accent-primary); box-shadow: 0 0 10px var(--accent-primary); }
        .turn-dot.done { background: var(--accent-green); }
        .timer-display { font-size: 4rem; font-weight: 700; text-align: center; font-variant-numeric: tabular-nums; }
        .timer-display.warning { color: var(--accent-gold); animation: pulse 0.5s infinite; }
        .timer-display.danger { color: var(--accent-primary); animation: pulse 0.3s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .timer-bar { height: 8px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden; margin: 20px 0; }
        .timer-bar-fill { height: 100%; background: var(--gradient-primary); border-radius: 4px; transition: width 1s linear; }
        .vote-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0; }
        .vote-option { padding: 20px 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 14px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .vote-option:hover { border-color: var(--accent-primary); }
        .vote-option.selected { border-color: var(--accent-primary); background: rgba(233,69,96,0.15); }
        .vote-option.disabled { opacity: 0.4; pointer-events: none; }
        .vote-count { font-size: 1.5rem; font-weight: 700; color: var(--accent-primary); margin-top: 8px; }
        .results-outcome { font-size: 1.8rem; font-weight: 700; text-align: center; margin-bottom: 8px; }
        .results-outcome.crew-win { color: var(--accent-green); }
        .results-outcome.imposter-win { color: var(--accent-primary); }
        .results-subtitle { text-align: center; color: var(--text-secondary); margin-bottom: 30px; }
        .results-word-box { background: var(--bg-card); border-radius: 16px; padding: 24px; margin-bottom: 24px; text-align: center; border: 1px solid var(--border-color); }
        .results-word-label { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; }
        .results-word { font-size: 2rem; font-weight: 700; color: var(--accent-gold); }
        .results-section { margin-top: 20px; }
        .results-section-title { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; text-align: center; }
        .results-players { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .results-player { padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 500; }
        .results-player.imposter { background: rgba(233,69,96,0.2); color: var(--accent-primary); border: 1px solid var(--accent-primary); }
        .results-player.crew { background: rgba(0,212,170,0.2); color: var(--accent-green); border: 1px solid var(--accent-green); }
        .vote-result-item { display: flex; justify-content: space-between; padding: 12px 16px; background: var(--bg-secondary); border-radius: 10px; margin-bottom: 8px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .stat-card { background: var(--bg-secondary); border-radius: 14px; padding: 20px; text-align: center; border: 1px solid var(--border-color); }
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--accent-primary); }
        .stat-label { font-size: 0.8rem; color: var(--text-muted); margin-top: 4px; }
        .nav-back { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 0.9rem; cursor: pointer; padding: 8px 0; margin-bottom: 10px; }
        .nav-back:hover { color: var(--accent-primary); }
        .spacer { flex: 1; }
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .add-form { display: flex; gap: 10px; margin-bottom: 16px; }
        .add-form .input-field { flex: 1; }
        .add-form .btn { width: auto; padding: 14px 20px; }
        .discussion-hint { text-align: center; padding: 20px; color: var(--text-secondary); }
        .reveal-player-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--bg-secondary); border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .reveal-player-item:hover { border-color: var(--accent-primary); transform: translateX(5px); }
        .reveal-player-item.done { opacity: 0.5; cursor: default; pointer-events: none; background: rgba(0,212,170,0.1); border-color: var(--accent-green); }
        .reveal-player-item.done:hover { transform: none; }
        .reveal-player-item .player-num { width: 32px; height: 32px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; font-weight: 600; }
        .reveal-player-item.done .player-num { background: var(--accent-green); }
        .reveal-player-item .player-name { flex: 1; font-weight: 500; font-size: 1.05rem; }
        .reveal-player-item .status { font-size: 1.2rem; }
        .reveal-player-item.done .status::after { content: '‚úì'; color: var(--accent-green); }
        .vote-player-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--bg-secondary); border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .vote-player-item:hover { border-color: var(--accent-primary); transform: translateX(5px); }
        .vote-player-item.voted { opacity: 0.5; cursor: default; pointer-events: none; background: rgba(0,212,170,0.1); border-color: var(--accent-green); }
        .vote-player-item.voted:hover { transform: none; }
        .vote-player-item .player-num { width: 32px; height: 32px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; font-weight: 600; }
        .vote-player-item.voted .player-num { background: var(--accent-green); }
        .vote-player-item .player-name { flex: 1; font-weight: 500; font-size: 1.05rem; }
        .vote-player-item .status { font-size: 1.2rem; }
        .vote-player-item.voted .status::after { content: '‚úì'; color: var(--accent-green); }
    </style>
</head>
<body>
<div class="app">
    <!-- Home Screen -->
    <div id="homeScreen" class="screen active">
        <div class="header">
            <div class="logo">üïµÔ∏è DONGA ATTA</div>
            <div class="tagline" style="font-size:1.1rem;color:var(--accent-gold);margin-bottom:5px;">‡∞¶‡±ä‡∞Ç‡∞ó ‡∞Ü‡∞ü</div>
            <div class="tagline">Telugu Fun Game ‚Ä¢ Family & Friends</div>
        </div>
        <div class="card mode-card" onclick="showScreen('quickStartScreen')">
            <div class="card-title">‚ö° Quick Start</div>
            <div class="mode-description">Fast setup with random category</div>
        </div>
        <div class="card mode-card" onclick="showScreen('categoryScreen')">
            <div class="card-title">üéØ Category Select</div>
            <div class="mode-description">Choose your Telugu category</div>
        </div>
        <div class="card mode-card" onclick="showScreen('setupScreen')">
            <div class="card-title">‚öôÔ∏è Full Setup</div>
            <div class="mode-description">Customize all settings</div>
        </div>
        <div class="spacer"></div>
        <button class="btn btn-secondary" onclick="showScreen('statsScreen')">üìä View Statistics</button>
    </div>

    <!-- Quick Start Screen -->
    <div id="quickStartScreen" class="screen">
        <div class="nav-back" onclick="showScreen('homeScreen')">‚Üê Back</div>
        <div class="header" style="padding-bottom:15px;">
            <div class="logo" style="font-size:1.8rem;">‚ö° Quick Start</div>
            <div class="tagline">Random category ‚Ä¢ No timer</div>
        </div>
        <div class="card">
            <div class="card-title">üë• Players</div>
            <form class="add-form" onsubmit="addQuickPlayer(event)">
                <input type="text" class="input-field" id="quickPlayerInput" placeholder="Enter name" maxlength="15">
                <button type="submit" class="btn btn-primary">Add</button>
            </form>
            <div class="player-list" id="quickPlayerList"></div>
        </div>
        <div class="card">
            <div class="card-title">üé≠ Imposters</div>
            <div class="setting-row">
                <span>Number of Imposters</span>
                <div class="number-selector">
                    <button type="button" class="number-btn" onclick="changeQuickImposters(-1)">‚àí</button>
                    <span class="number-value" id="quickImposterCount">1</span>
                    <button type="button" class="number-btn" onclick="changeQuickImposters(1)">+</button>
                </div>
            </div>
            <div class="info-box" id="quickImposterInfo">Add at least 4 players</div>
        </div>
        <div class="card">
            <div class="card-title">üó≥Ô∏è Voting Type</div>
            <div class="setting-row">
                <div>
                    <span class="setting-label">How to vote</span>
                </div>
                <select class="select-field" id="quickVoteType" style="width:auto;" onchange="updateQuickVoteInfo()">
                    <option value="individual">üôã Individual</option>
                    <option value="group">üó£Ô∏è Group</option>
                </select>
            </div>
            <div class="info-box" id="quickVoteTypeInfo">Each player secretly votes, results revealed together</div>
        </div>
        <div class="spacer"></div>
        <button class="btn btn-primary" id="quickStartBtn" onclick="quickStart()" disabled>üéÆ Start Game</button>
    </div>

    <!-- Category Select Screen -->
    <div id="categoryScreen" class="screen">
        <div class="nav-back" onclick="showScreen('homeScreen')">‚Üê Back</div>
        <h2 style="margin-bottom:20px;">Category Select</h2>
        
        <div class="card">
            <div class="card-title">üë• Players</div>
            <form class="add-form" onsubmit="addCatPlayer(event)">
                <input type="text" class="input-field" id="catPlayerInput" placeholder="Enter name" maxlength="15">
                <button type="submit" class="btn btn-primary">Add</button>
            </form>
            <div class="player-list" id="catPlayerList"></div>
        </div>
        
        <div class="card">
            <div class="card-title">üé≠ Imposters</div>
            <div class="setting-row">
                <span>Number of Imposters</span>
                <div class="number-selector">
                    <button type="button" class="number-btn" onclick="changeCatImposters(-1)">‚àí</button>
                    <span class="number-value" id="catImposterCount">1</span>
                    <button type="button" class="number-btn" onclick="changeCatImposters(1)">+</button>
                </div>
            </div>
            <div class="info-box" id="catImposterInfo">Add at least 4 players</div>
        </div>
        
        <div class="card">
            <div class="card-title">üó≥Ô∏è Voting Type</div>
            <div class="setting-row">
                <div>
                    <span class="setting-label">How to vote</span>
                </div>
                <select class="select-field" id="catVoteType" style="width:auto;" onchange="updateCatVoteInfo()">
                    <option value="individual">üôã Individual</option>
                    <option value="group">üó£Ô∏è Group</option>
                </select>
            </div>
            <div class="info-box" id="catVoteTypeInfo">Each player secretly votes, results revealed together</div>
        </div>
        
        <div class="card">
            <div class="card-title">üìÇ Select Category</div>
            <div class="category-grid" id="categoryGrid"></div>
        </div>
        
        <div class="spacer"></div>
        <button class="btn btn-primary" id="startCategoryBtn" onclick="startWithCategory()" disabled>üéÆ Start Game</button>
    </div>

    <!-- Setup Screen -->
    <div id="setupScreen" class="screen">
        <div class="nav-back" onclick="showScreen('homeScreen')">‚Üê Back</div>
        <h2 style="margin-bottom:20px;">Game Setup</h2>
        <div class="card">
            <div class="card-title">üë• Players</div>
            <form class="add-form" onsubmit="addPlayer(event)">
                <input type="text" class="input-field" id="playerInput" placeholder="Enter name" maxlength="15">
                <button type="submit" class="btn btn-primary">Add</button>
            </form>
            <div class="player-list" id="playerList"></div>
        </div>
        <div class="card">
            <div class="card-title">üé≠ Imposters</div>
            <div class="setting-row">
                <span>Number of Imposters</span>
                <div class="number-selector">
                    <button type="button" class="number-btn" onclick="changeImposters(-1)">‚àí</button>
                    <span class="number-value" id="imposterCount">1</span>
                    <button type="button" class="number-btn" onclick="changeImposters(1)">+</button>
                </div>
            </div>
            <div class="info-box" id="imposterInfo">Add at least 4 players</div>
        </div>
        <div class="card">
            <div class="card-title">üìÇ Category</div>
            <select class="select-field" id="categorySelect"></select>
        </div>
        <div class="card">
            <div class="card-title">‚è±Ô∏è Timer</div>
            <div class="setting-row">
                <span>Enable Timer</span>
                <label class="toggle"><input type="checkbox" id="timerToggle" onchange="toggleTimer()"><span class="toggle-slider"></span></label>
            </div>
            <div id="timerOptions" style="display:none;">
                <div class="setting-row">
                    <span>Duration</span>
                    <select class="select-field" id="timerDuration" style="width:auto;">
                        <option value="15">15s</option>
                        <option value="30">30s</option>
                        <option value="45" selected>45s</option>
                        <option value="60">60s</option>
                        <option value="90">90s</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">üó≥Ô∏è Voting</div>
            <div class="setting-row">
                <div>
                    <span class="setting-label">Voting Type</span>
                    <div class="setting-description">How votes are cast</div>
                </div>
                <select class="select-field" id="voteType" style="width:auto;">
                    <option value="individual">üôã Individual</option>
                    <option value="group">üó£Ô∏è Group</option>
                </select>
            </div>
            <div class="info-box" id="voteTypeInfo">Each player secretly votes, results revealed together</div>
            <div class="setting-row">
                <span>Allow Skip</span>
                <label class="toggle"><input type="checkbox" id="allowSkip"><span class="toggle-slider"></span></label>
            </div>
        </div>
        <div class="spacer"></div>
        <button class="btn btn-primary" id="startGameBtn" onclick="startGame()" disabled>üéÆ Start Game</button>
    </div>

    <!-- Reveal Screen -->
    <div id="revealScreen" class="screen">
        <h2 style="text-align:center;margin-bottom:10px;">Word Distribution</h2>
        <p style="text-align:center;color:var(--text-secondary);margin-bottom:20px;">Tap your name to see your word</p>
        
        <!-- Player Selection List -->
        <div id="revealPlayerList" class="card">
            <div class="card-title">üë• Players</div>
            <div id="revealPlayers"></div>
        </div>
        
        <div class="spacer"></div>
        <button class="btn btn-primary" id="startDiscussionBtn" onclick="goToDiscussion()" style="display:none;">
            ‚úÖ All Ready! Start Discussion ‚Üí
        </button>
    </div>
    
    <!-- Category Reveal Screen -->
    <div id="categoryRevealScreen" class="screen">
        <div class="reveal-container">
            <div class="reveal-player">Your turn</div>
            <div class="reveal-name" id="catRevealName"></div>
            <div class="reveal-card" id="catRevealCard" onclick="showWordReveal()">
                <div class="reveal-card-front" style="background:var(--bg-card);border:3px solid var(--accent-gold);">
                    <div style="font-size:0.9rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:15px;">Category</div>
                    <div style="font-size:2rem;color:var(--accent-gold);font-weight:700;" id="catRevealCategory"></div>
                    <div style="margin-top:30px;color:var(--text-secondary);font-size:0.9rem;">üëÜ Tap to see your word</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Word Reveal Screen -->
    <div id="wordRevealScreen" class="screen">
        <div class="reveal-container">
            <div class="reveal-player" id="wordRevealPlayerName"></div>
            <div class="reveal-card" id="wordRevealCard" onclick="hideWordAndReturn()">
                <div class="reveal-card-front" style="background:var(--bg-card);border:3px solid var(--accent-primary);">
                    <div class="reveal-role" id="wordRevealRole"></div>
                    <div class="reveal-word" id="wordRevealWord"></div>
                    <div style="margin-top:30px;color:var(--text-secondary);font-size:0.9rem;">üëÜ Tap to hide & go back</div>
                </div>
            </div>
            <div style="margin-top:20px;color:var(--text-muted);font-size:0.85rem;">
                ‚ö†Ô∏è Remember your word, don't show others!
            </div>
        </div>
    </div>

    <!-- Discussion Screen -->
    <div id="discussionScreen" class="screen">
        <h2 style="text-align:center;margin-bottom:20px;">Discussion Round</h2>
        <div class="card" id="timerCard" style="display:none;">
            <div class="turn-dots" id="discussDots"></div>
            <div style="text-align:center;font-weight:600;margin-bottom:10px;" id="discussPlayer"></div>
            <div class="timer-display" id="timerDisplay">45</div>
            <div class="timer-bar"><div class="timer-bar-fill" id="timerBar"></div></div>
            <button class="btn btn-secondary" onclick="nextDiscuss()">Next Player</button>
        </div>
        <div class="card" id="noTimerCard">
            <div class="discussion-hint">
                <div style="font-size:1.1rem;margin-bottom:10px;">Describe your word without saying it!</div>
                <div>Find the imposter(s) among you üîç</div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">üìã Players</div>
            <div id="discussList"></div>
        </div>
        <div class="spacer"></div>
        <button class="btn btn-primary" onclick="startVoting()">üó≥Ô∏è Start Voting</button>
    </div>

    <!-- Voting Screen -->
    <div id="votingScreen" class="screen">
        <h2 style="text-align:center;margin-bottom:10px;">Voting Round</h2>
        <p style="text-align:center;color:var(--text-secondary);margin-bottom:20px;" id="voteInstruction"></p>
        
        <!-- Individual Vote: Player Selection List -->
        <div id="votePlayerListSection" class="card" style="display:none;">
            <div class="card-title">üó≥Ô∏è Tap your name to vote</div>
            <div id="votePlayerList"></div>
        </div>
        
        <!-- Group Vote: Direct voting grid -->
        <div id="groupVoteSection" style="display:none;">
            <div class="vote-grid" id="voteGrid"></div>
        </div>
        
        <div class="spacer"></div>
        
        <div class="btn-group">
            <button class="btn btn-primary" id="revealResultsBtn" onclick="showResults()" style="display:none;">
                üéâ Reveal Results
            </button>
            <button class="btn btn-primary" id="confirmVoteBtn" onclick="confirmVote()" style="display:none;" disabled>
                Confirm Vote
            </button>
            <button class="btn btn-outline" id="skipVoteBtn" onclick="skipVote()" style="display:none;">
                Skip Vote
            </button>
        </div>
    </div>
    
    <!-- Individual Vote Screen -->
    <div id="individualVoteScreen" class="screen">
        <div style="text-align:center;margin-bottom:20px;">
            <div style="color:var(--text-secondary);margin-bottom:5px;">Voting</div>
            <h2 id="voterName"></h2>
        </div>
        <p style="text-align:center;color:var(--text-secondary);margin-bottom:20px;">Who is the imposter?</p>
        
        <div class="vote-grid" id="individualVoteGrid"></div>
        
        <div class="spacer"></div>
        
        <div class="btn-group">
            <button class="btn btn-outline" id="indSkipBtn" onclick="submitIndividualVote(-1)" style="display:none;">
                Skip Vote
            </button>
            <button class="btn btn-primary" id="indConfirmBtn" onclick="submitIndividualVote()" disabled>
                Confirm Vote
            </button>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="resultsScreen" class="screen">
        <div class="results-outcome" id="resultsOutcome"></div>
        <div class="results-subtitle" id="resultsSub"></div>
        <div class="results-word-box">
            <div class="results-word-label">The Secret Word Was</div>
            <div class="results-word" id="resultsWord"></div>
        </div>
        <div class="results-section">
            <div class="results-section-title">Imposters</div>
            <div class="results-players" id="resultsImposters"></div>
        </div>
        <div class="results-section">
            <div class="results-section-title">Crew Members</div>
            <div class="results-players" id="resultsCrew"></div>
        </div>
        <div class="results-section" id="voteResultsSection">
            <div class="results-section-title">Vote Results</div>
            <div id="voteResults"></div>
        </div>
        <div class="spacer"></div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="playAgain()">üîÑ Play Again</button>
            <button class="btn btn-secondary" onclick="goHome()">üè† Main Menu</button>
        </div>
    </div>

    <!-- Stats Screen -->
    <div id="statsScreen" class="screen">
        <div class="nav-back" onclick="showScreen('homeScreen')">‚Üê Back</div>
        <h2 style="margin-bottom:20px;">Statistics</h2>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-value" id="statGames">0</div><div class="stat-label">Games</div></div>
            <div class="stat-card"><div class="stat-value" id="statCrewWins">0</div><div class="stat-label">Crew Wins</div></div>
            <div class="stat-card"><div class="stat-value" id="statImpWins">0</div><div class="stat-label">Imposter Wins</div></div>
            <div class="stat-card"><div class="stat-value" id="statRate">0%</div><div class="stat-label">Crew Win Rate</div></div>
        </div>
        <div class="spacer"></div>
        <button class="btn btn-outline" onclick="clearStats()">üóëÔ∏è Clear Stats</button>
    </div>
</div>

<script>
// Categories
const categories = {
    festivals: { name: "Telugu Festivals", emoji: "üéâ", words: ["Sankranti", "Ugadi", "Bonalu", "Bathukamma", "Dussehra", "Diwali", "Vinayaka Chavithi", "Rama Navami", "Krishna Janmashtami", "Shivaratri", "Holi", "Bhogi", "Kanuma", "Varalakshmi Vratam"] },
    food: { name: "Telugu Food", emoji: "üçõ", words: ["Biryani", "Pesarattu", "Gongura", "Pulihora", "Pappu", "Avakaya", "Gutti Vankaya", "Chepa Pulusu", "Mirchi Bajji", "Punugulu", "Boorelu", "Ariselu", "Pootharekulu", "Bobbatlu", "Payasam", "Uggani"] },
    movies: { name: "Telugu Movies", emoji: "üé¨", words: ["Baahubali", "RRR", "Pushpa", "Magadheera", "Eega", "Arjun Reddy", "Ala Vaikunthapurramuloo", "Jersey", "Rangasthalam", "Athadu", "Pokiri", "Bommarillu", "Happy Days", "Dookudu", "Okkadu", "Simhadri"] },
    actors: { name: "Telugu Actors", emoji: "üé≠", words: ["Chiranjeevi", "Prabhas", "Mahesh Babu", "NTR Jr", "Allu Arjun", "Ram Charan", "Nagarjuna", "Venkatesh", "Pawan Kalyan", "Ravi Teja", "Vijay Deverakonda", "Nani", "Balakrishna", "Brahmanandam"] },
    actresses: { name: "Telugu Actresses", emoji: "üíÉ", words: ["Samantha", "Rashmika", "Kajal Aggarwal", "Anushka Shetty", "Tamannaah", "Pooja Hegde", "Sai Pallavi", "Keerthy Suresh", "Nayanthara", "Trisha", "Rakul Preet", "Sreeleela"] },
    directors: { name: "Telugu Directors", emoji: "üé•", words: ["Rajamouli", "Trivikram", "Sukumar", "Koratala Siva", "Boyapati", "Puri Jagannadh", "Sekhar Kammula", "Nag Ashwin", "Sandeep Vanga", "Anil Ravipudi", "Harish Shankar"] },
    songs: { name: "Telugu Songs", emoji: "üéµ", words: ["Srivalli", "Naatu Naatu", "Butta Bomma", "Ramuloo Ramulaa", "Samajavaragamana", "Inkem Inkem", "Seeti Maar", "Dheevara", "Oo Antava", "Dandalayya", "Mind Block"] },
    places: { name: "AP/TS Places", emoji: "üèõÔ∏è", words: ["Hyderabad", "Visakhapatnam", "Vijayawada", "Tirupati", "Warangal", "Guntur", "Charminar", "Golconda", "Ramoji Film City", "Hussain Sagar", "Araku Valley", "Srisailam", "Tirumala"] },
    games: { name: "Traditional Games", emoji: "üéØ", words: ["Kabaddi", "Kho Kho", "Gilli Danda", "Lagori", "Carrom", "Kite Flying", "Marbles", "Hide and Seek", "Seven Stones", "Antakshari", "Dumb Charades", "Cricket"] },
    traditions: { name: "Telugu Customs", emoji: "ü™î", words: ["Mangalsutra", "Mehendi", "Saree", "Pooja", "Namaskaram", "Arati", "Prasadam", "Tilak", "Kumkum", "Tulasi Puja", "Saptapadi", "Coconut"] },
    sweets: { name: "Telugu Sweets", emoji: "üç¨", words: ["Laddu", "Jalebi", "Gulab Jamun", "Mysore Pak", "Kaju Katli", "Badusha", "Double Ka Meetha", "Kheer", "Halwa", "Peda", "Murukku", "Arishelu"] },
    dialogues: { name: "Famous Dialogues", emoji: "üí¨", words: ["Oka Saari Commit", "Nenu Local", "Pushpa Raj", "Taggedhe Le", "Mind Block", "Mega Star", "Power Star", "Icon Star", "Jai Balayya", "Jai Chiranjeeva"] }
};

// Game State
let game = {
    players: [],
    quickPlayers: [],
    catPlayers: [],
    imposters: [],
    imposterCount: 1,
    quickImposterCount: 1,
    catImposterCount: 1,
    category: null,
    categoryName: '',
    secretWord: '',
    timerEnabled: false,
    timerDuration: 45,
    voteType: 'individual',
    allowSkip: false,
    revealIndex: 0,
    revealedPlayers: [],
    currentRevealPlayer: null,
    discussIndex: 0,
    voteIndex: 0,
    votes: {},
    votedPlayers: [],
    currentVoter: null,
    selectedVote: null,
    cardFlipped: false,
    timerInterval: null
};

// Init
function init() {
    populateCategories();
    loadStats();
    
    // Vote type info update
    document.getElementById('voteType').addEventListener('change', function() {
        const info = document.getElementById('voteTypeInfo');
        if (this.value === 'individual') {
            info.textContent = 'Each player secretly votes, results revealed together';
        } else {
            info.textContent = 'Discuss and cast one final group vote';
        }
    });
}

// Quick Start Player Management
function addQuickPlayer(e) {
    e.preventDefault();
    const input = document.getElementById('quickPlayerInput');
    const name = input.value.trim();
    if (name && game.quickPlayers.length < 15 && !game.quickPlayers.includes(name)) {
        game.quickPlayers.push(name);
        updateQuickPlayerList();
        updateQuickImposterInfo();
    }
    input.value = '';
    input.focus();
}

function removeQuickPlayer(i) {
    game.quickPlayers.splice(i, 1);
    updateQuickPlayerList();
    updateQuickImposterInfo();
}

function updateQuickPlayerList() {
    const list = document.getElementById('quickPlayerList');
    list.innerHTML = game.quickPlayers.map((p, i) => `
        <div class="player-item">
            <div class="player-num">${i+1}</div>
            <div class="player-name">${p}</div>
            <button class="player-remove" onclick="removeQuickPlayer(${i})">√ó</button>
        </div>
    `).join('');
    document.getElementById('quickStartBtn').disabled = game.quickPlayers.length < 4;
}

function updateQuickImposterInfo() {
    const n = game.quickPlayers.length;
    const info = document.getElementById('quickImposterInfo');
    if (n < 4) {
        info.textContent = 'Add at least 4 players';
        game.quickImposterCount = 1;
    } else {
        const min = n > 10 ? 2 : 1;
        const max = n - 2;
        game.quickImposterCount = Math.max(min, Math.min(game.quickImposterCount, max));
        info.textContent = `With ${n} players: ${min} to ${max} imposters allowed`;
    }
    document.getElementById('quickImposterCount').textContent = game.quickImposterCount;
}

function changeQuickImposters(d) {
    const n = game.quickPlayers.length;
    if (n < 4) return;
    const min = n > 10 ? 2 : 1;
    const max = n - 2;
    const newCount = game.quickImposterCount + d;
    if (newCount >= min && newCount <= max) {
        game.quickImposterCount = newCount;
        document.getElementById('quickImposterCount').textContent = newCount;
    }
}

function updateQuickVoteInfo() {
    const voteType = document.getElementById('quickVoteType').value;
    const info = document.getElementById('quickVoteTypeInfo');
    if (voteType === 'individual') {
        info.textContent = 'Each player secretly votes, results revealed together';
    } else {
        info.textContent = 'Discuss and cast one final group vote';
    }
}

function updateCatVoteInfo() {
    const voteType = document.getElementById('catVoteType').value;
    const info = document.getElementById('catVoteTypeInfo');
    if (voteType === 'individual') {
        info.textContent = 'Each player secretly votes, results revealed together';
    } else {
        info.textContent = 'Discuss and cast one final group vote';
    }
}

// Category Select Player Management
function addCatPlayer(e) {
    e.preventDefault();
    const input = document.getElementById('catPlayerInput');
    const name = input.value.trim();
    if (name && game.catPlayers.length < 15 && !game.catPlayers.includes(name)) {
        game.catPlayers.push(name);
        updateCatPlayerList();
        updateCatImposterInfo();
        checkCatStartBtn();
    }
    input.value = '';
    input.focus();
}

function removeCatPlayer(i) {
    game.catPlayers.splice(i, 1);
    updateCatPlayerList();
    updateCatImposterInfo();
    checkCatStartBtn();
}

function updateCatPlayerList() {
    const list = document.getElementById('catPlayerList');
    list.innerHTML = game.catPlayers.map((p, i) => `
        <div class="player-item">
            <div class="player-num">${i+1}</div>
            <div class="player-name">${p}</div>
            <button class="player-remove" onclick="removeCatPlayer(${i})">√ó</button>
        </div>
    `).join('');
}

function updateCatImposterInfo() {
    const n = game.catPlayers.length;
    const info = document.getElementById('catImposterInfo');
    if (n < 4) {
        info.textContent = 'Add at least 4 players';
        game.catImposterCount = 1;
    } else {
        const min = n > 10 ? 2 : 1;
        const max = n - 2;
        game.catImposterCount = Math.max(min, Math.min(game.catImposterCount, max));
        info.textContent = `With ${n} players: ${min} to ${max} imposters allowed`;
    }
    document.getElementById('catImposterCount').textContent = game.catImposterCount;
}

function changeCatImposters(d) {
    const n = game.catPlayers.length;
    if (n < 4) return;
    const min = n > 10 ? 2 : 1;
    const max = n - 2;
    const newCount = game.catImposterCount + d;
    if (newCount >= min && newCount <= max) {
        game.catImposterCount = newCount;
        document.getElementById('catImposterCount').textContent = newCount;
    }
}

function checkCatStartBtn() {
    const hasPlayers = game.catPlayers.length >= 4;
    const hasCategory = game.category !== null;
    document.getElementById('startCategoryBtn').disabled = !(hasPlayers && hasCategory);
}

function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function populateCategories() {
    const grid = document.getElementById('categoryGrid');
    const select = document.getElementById('categorySelect');
    grid.innerHTML = '';
    select.innerHTML = '<option value="random">üé≤ Random</option>';
    
    Object.keys(categories).forEach(key => {
        const cat = categories[key];
        grid.innerHTML += `<div class="category-item" data-cat="${key}" onclick="selectCat(this,'${key}')">
            <div class="category-emoji">${cat.emoji}</div>
            <div class="category-name">${cat.name}</div>
        </div>`;
        select.innerHTML += `<option value="${key}">${cat.emoji} ${cat.name}</option>`;
    });
    
    grid.innerHTML += `<div class="category-item" data-cat="random" onclick="selectCat(this,'random')">
        <div class="category-emoji">üé≤</div>
        <div class="category-name">Random</div>
    </div>`;
}

function selectCat(el, key) {
    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('selected'));
    el.classList.add('selected');
    game.category = key;
    checkCatStartBtn();
}

function addPlayer(e) {
    e.preventDefault();
    const input = document.getElementById('playerInput');
    const name = input.value.trim();
    if (name && game.players.length < 15 && !game.players.includes(name)) {
        game.players.push(name);
        updatePlayerList();
        updateImposterInfo();
    }
    input.value = '';
    input.focus();
}

function removePlayer(i) {
    game.players.splice(i, 1);
    updatePlayerList();
    updateImposterInfo();
}

function updatePlayerList() {
    const list = document.getElementById('playerList');
    list.innerHTML = game.players.map((p, i) => `
        <div class="player-item">
            <div class="player-num">${i+1}</div>
            <div class="player-name">${p}</div>
            <button class="player-remove" onclick="removePlayer(${i})">√ó</button>
        </div>
    `).join('');
    document.getElementById('startGameBtn').disabled = game.players.length < 4;
}

function updateImposterInfo() {
    const n = game.players.length;
    const info = document.getElementById('imposterInfo');
    if (n < 4) {
        info.textContent = 'Add at least 4 players';
        game.imposterCount = 1;
    } else {
        const min = n > 10 ? 2 : 1;
        const max = n - 2;
        game.imposterCount = Math.max(min, Math.min(game.imposterCount, max));
        info.textContent = `With ${n} players: ${min} to ${max} imposters allowed`;
    }
    document.getElementById('imposterCount').textContent = game.imposterCount;
}

function changeImposters(d) {
    const n = game.players.length;
    if (n < 4) return;
    const min = n > 10 ? 2 : 1;
    const max = n - 2;
    const newCount = game.imposterCount + d;
    if (newCount >= min && newCount <= max) {
        game.imposterCount = newCount;
        document.getElementById('imposterCount').textContent = newCount;
    }
}

function toggleTimer() {
    game.timerEnabled = document.getElementById('timerToggle').checked;
    document.getElementById('timerOptions').style.display = game.timerEnabled ? 'block' : 'none';
}

function quickStart() {
    if (game.quickPlayers.length < 4) return;
    game.players = [...game.quickPlayers];
    game.imposterCount = game.quickImposterCount;
    game.category = 'random';
    game.timerEnabled = false;
    game.voteType = document.getElementById('quickVoteType').value;
    game.allowSkip = true;
    startGame();
}

function startWithCategory() {
    if (!game.category || game.catPlayers.length < 4) return;
    game.players = [...game.catPlayers];
    game.imposterCount = game.catImposterCount;
    game.timerEnabled = false;
    game.voteType = document.getElementById('catVoteType').value;
    game.allowSkip = true;
    startGame();
}

function startGame() {
    // Get settings if on setup screen
    if (document.getElementById('setupScreen').classList.contains('active')) {
        game.category = document.getElementById('categorySelect').value;
        game.timerEnabled = document.getElementById('timerToggle').checked;
        game.timerDuration = parseInt(document.getElementById('timerDuration').value);
        game.voteType = document.getElementById('voteType').value;
        game.allowSkip = document.getElementById('allowSkip').checked;
    }
    
    // Pick category and word
    let catKey = game.category === 'random' ? Object.keys(categories)[Math.floor(Math.random() * Object.keys(categories).length)] : game.category;
    const cat = categories[catKey];
    game.secretWord = cat.words[Math.floor(Math.random() * cat.words.length)];
    game.categoryName = cat.name;
    
    // Assign imposters
    const indices = [...Array(game.players.length).keys()].sort(() => Math.random() - 0.5);
    game.imposters = indices.slice(0, game.imposterCount);
    
    // Reset state
    game.revealIndex = 0;
    game.discussIndex = 0;
    game.voteIndex = 0;
    game.votes = {};
    game.selectedVote = null;
    game.cardFlipped = false;
    game.revealedPlayers = [];
    
    showScreen('revealScreen');
    showRevealPlayerList();
}

function showRevealPlayerList() {
    const container = document.getElementById('revealPlayers');
    container.innerHTML = game.players.map((p, i) => {
        const isDone = game.revealedPlayers.includes(i);
        return `<div class="reveal-player-item ${isDone ? 'done' : ''}" onclick="${isDone ? '' : `selectPlayerToReveal(${i})`}">
            <div class="player-num">${i+1}</div>
            <div class="player-name">${p}</div>
            <div class="status"></div>
        </div>`;
    }).join('');
    
    // Show start discussion button if all players have seen their word
    const allRevealed = game.revealedPlayers.length === game.players.length;
    document.getElementById('startDiscussionBtn').style.display = allRevealed ? 'block' : 'none';
}

function selectPlayerToReveal(index) {
    game.currentRevealPlayer = index;
    const player = game.players[index];
    
    // Show category first
    document.getElementById('catRevealName').textContent = player;
    document.getElementById('catRevealCategory').textContent = game.categoryName;
    
    showScreen('categoryRevealScreen');
}

function showWordReveal() {
    const index = game.currentRevealPlayer;
    const player = game.players[index];
    const isImp = game.imposters.includes(index);
    
    document.getElementById('wordRevealPlayerName').textContent = player;
    document.getElementById('wordRevealRole').textContent = isImp ? 'üé≠ IMPOSTER' : 'üë§ CREW MEMBER';
    document.getElementById('wordRevealWord').textContent = isImp ? 'IMPOSTER' : game.secretWord;
    document.getElementById('wordRevealWord').className = 'reveal-word' + (isImp ? ' imposter' : '');
    
    showScreen('wordRevealScreen');
}

function hideWordAndReturn() {
    // Mark player as done
    if (!game.revealedPlayers.includes(game.currentRevealPlayer)) {
        game.revealedPlayers.push(game.currentRevealPlayer);
    }
    
    showScreen('revealScreen');
    showRevealPlayerList();
}

function goToDiscussion() {
    showScreen('discussionScreen');
    initDiscussion();
}

function updateDots(id, current) {
    const container = document.getElementById(id);
    container.innerHTML = game.players.map((_, i) => 
        `<div class="turn-dot ${i < current ? 'done' : ''} ${i === current ? 'active' : ''}"></div>`
    ).join('');
}

function initDiscussion() {
    const list = document.getElementById('discussList');
    list.innerHTML = game.players.map((p, i) => `
        <div class="player-item">
            <div class="player-num">${i+1}</div>
            <div class="player-name">${p}</div>
        </div>
    `).join('');
    
    if (game.timerEnabled) {
        document.getElementById('timerCard').style.display = 'block';
        document.getElementById('noTimerCard').style.display = 'none';
        game.discussIndex = 0;
        startTimer();
    } else {
        document.getElementById('timerCard').style.display = 'none';
        document.getElementById('noTimerCard').style.display = 'block';
    }
}

function startTimer() {
    updateDots('discussDots', game.discussIndex);
    document.getElementById('discussPlayer').textContent = game.players[game.discussIndex] + "'s Turn";
    
    let time = game.timerDuration;
    const display = document.getElementById('timerDisplay');
    const bar = document.getElementById('timerBar');
    
    display.textContent = time;
    display.className = 'timer-display';
    bar.style.width = '100%';
    
    if (game.timerInterval) clearInterval(game.timerInterval);
    
    game.timerInterval = setInterval(() => {
        time--;
        display.textContent = time;
        bar.style.width = (time / game.timerDuration * 100) + '%';
        
        if (time <= 10) display.className = 'timer-display warning';
        if (time <= 5) display.className = 'timer-display danger';
        
        if (time <= 0) {
            clearInterval(game.timerInterval);
            nextDiscuss();
        }
    }, 1000);
}

function nextDiscuss() {
    if (game.timerInterval) clearInterval(game.timerInterval);
    game.discussIndex++;
    if (game.discussIndex >= game.players.length) {
        startVoting();
    } else {
        startTimer();
    }
}

function startVoting() {
    showScreen('votingScreen');
    game.voteIndex = 0;
    game.votes = {};
    game.votedPlayers = [];
    game.selectedVote = null;
    game.currentVoter = null;
    
    if (game.voteType === 'individual') {
        setupIndividualVoting();
    } else {
        setupGroupVoting();
    }
}

// Individual Voting Mode
function setupIndividualVoting() {
    document.getElementById('voteInstruction').textContent = 'Each player taps their name to vote secretly';
    document.getElementById('votePlayerListSection').style.display = 'block';
    document.getElementById('groupVoteSection').style.display = 'none';
    document.getElementById('confirmVoteBtn').style.display = 'none';
    document.getElementById('skipVoteBtn').style.display = 'none';
    
    updateVotePlayerList();
}

function updateVotePlayerList() {
    const container = document.getElementById('votePlayerList');
    container.innerHTML = game.players.map((p, i) => {
        const hasVoted = game.votedPlayers.includes(i);
        return `<div class="vote-player-item ${hasVoted ? 'voted' : ''}" onclick="${hasVoted ? '' : `selectVoter(${i})`}">
            <div class="player-num">${i+1}</div>
            <div class="player-name">${p}</div>
            <div class="status"></div>
        </div>`;
    }).join('');
    
    // Show reveal button if all players have voted
    const allVoted = game.votedPlayers.length === game.players.length;
    document.getElementById('revealResultsBtn').style.display = allVoted ? 'block' : 'none';
}

function selectVoter(index) {
    game.currentVoter = index;
    game.selectedVote = null;
    
    document.getElementById('voterName').textContent = game.players[index];
    
    // Build vote options (exclude self)
    const grid = document.getElementById('individualVoteGrid');
    grid.innerHTML = game.players.map((p, i) => {
        if (i === index) return ''; // Can't vote for self
        return `<div class="vote-option" data-index="${i}" onclick="selectIndividualVote(${i}, this)">
            <div>${p}</div>
        </div>`;
    }).join('');
    
    document.getElementById('indSkipBtn').style.display = game.allowSkip ? 'block' : 'none';
    document.getElementById('indConfirmBtn').disabled = true;
    
    showScreen('individualVoteScreen');
}

function selectIndividualVote(index, el) {
    document.querySelectorAll('#individualVoteGrid .vote-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
    game.selectedVote = index;
    document.getElementById('indConfirmBtn').disabled = false;
}

function submitIndividualVote(skip) {
    if (skip === -1) {
        game.votes[game.currentVoter] = -1; // Skip
    } else {
        if (game.selectedVote === null) return;
        game.votes[game.currentVoter] = game.selectedVote;
    }
    
    game.votedPlayers.push(game.currentVoter);
    game.currentVoter = null;
    game.selectedVote = null;
    
    showScreen('votingScreen');
    updateVotePlayerList();
}

// Group Voting Mode
function setupGroupVoting() {
    document.getElementById('voteInstruction').textContent = 'Discuss and select one player as the imposter';
    document.getElementById('votePlayerListSection').style.display = 'none';
    document.getElementById('groupVoteSection').style.display = 'block';
    document.getElementById('confirmVoteBtn').style.display = 'block';
    document.getElementById('skipVoteBtn').style.display = game.allowSkip ? 'block' : 'none';
    document.getElementById('revealResultsBtn').style.display = 'none';
    document.getElementById('confirmVoteBtn').disabled = true;
    
    const grid = document.getElementById('voteGrid');
    grid.innerHTML = game.players.map((p, i) => `
        <div class="vote-option" data-index="${i}" onclick="selectGroupVote(${i}, this)">
            <div>${p}</div>
        </div>
    `).join('');
}

function selectGroupVote(index, el) {
    document.querySelectorAll('#voteGrid .vote-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
    game.selectedVote = index;
    document.getElementById('confirmVoteBtn').disabled = false;
}

function skipVote() {
    showResults();
}

function confirmVote() {
    if (game.selectedVote === null) return;
    game.votes[0] = game.selectedVote;
    showResults();
}

function showResults() {
    // Count votes
    const counts = {};
    game.players.forEach((_, i) => counts[i] = 0);
    Object.values(game.votes).forEach(v => { if (v >= 0) counts[v]++; });
    
    // Find most voted
    let max = 0, mostVoted = [];
    Object.entries(counts).forEach(([i, c]) => {
        if (c > max) { max = c; mostVoted = [parseInt(i)]; }
        else if (c === max && c > 0) mostVoted.push(parseInt(i));
    });
    
    // Determine winner
    let crewWins = mostVoted.length === 1 && game.imposters.includes(mostVoted[0]);
    
    // Display
    const outcome = document.getElementById('resultsOutcome');
    outcome.textContent = crewWins ? 'üéâ Crew Wins!' : 'üé≠ Imposters Win!';
    outcome.className = 'results-outcome ' + (crewWins ? 'crew-win' : 'imposter-win');
    
    document.getElementById('resultsSub').textContent = crewWins ? 'The imposter was found!' : 'The imposter escaped!';
    document.getElementById('resultsWord').textContent = game.secretWord;
    
    document.getElementById('resultsImposters').innerHTML = game.imposters.map(i => 
        `<span class="results-player imposter">${game.players[i]}</span>`
    ).join('');
    
    document.getElementById('resultsCrew').innerHTML = game.players.filter((_, i) => !game.imposters.includes(i)).map(p => 
        `<span class="results-player crew">${p}</span>`
    ).join('');
    
    document.getElementById('voteResults').innerHTML = Object.entries(counts)
        .filter(([_, c]) => c > 0)
        .sort((a, b) => b[1] - a[1])
        .map(([i, c]) => `
            <div class="vote-result-item">
                <span>${game.players[i]}</span>
                <span style="color:var(--accent-primary);font-weight:700;">${c} vote${c !== 1 ? 's' : ''}</span>
            </div>
        `).join('');
    
    updateStats(crewWins);
    showScreen('resultsScreen');
}

function playAgain() {
    game.revealIndex = 0;
    game.revealedPlayers = [];
    game.currentRevealPlayer = null;
    game.discussIndex = 0;
    game.voteIndex = 0;
    game.votes = {};
    game.selectedVote = null;
    game.cardFlipped = false;
    
    // New word
    let catKey = game.category === 'random' ? Object.keys(categories)[Math.floor(Math.random() * Object.keys(categories).length)] : game.category;
    const cat = categories[catKey];
    game.secretWord = cat.words[Math.floor(Math.random() * cat.words.length)];
    game.categoryName = cat.name;
    
    // Reassign imposters
    const indices = [...Array(game.players.length).keys()].sort(() => Math.random() - 0.5);
    game.imposters = indices.slice(0, game.imposterCount);
    
    showScreen('revealScreen');
    showRevealPlayerList();
}

function goHome() {
    if (game.timerInterval) clearInterval(game.timerInterval);
    game.players = [];
    game.quickPlayers = [];
    game.catPlayers = [];
    game.imposterCount = 1;
    game.quickImposterCount = 1;
    game.catImposterCount = 1;
    game.category = null;
    updatePlayerList();
    updateImposterInfo();
    // Reset Quick Start
    document.getElementById('quickPlayerList').innerHTML = '';
    document.getElementById('quickImposterCount').textContent = '1';
    document.getElementById('quickImposterInfo').textContent = 'Add at least 4 players';
    document.getElementById('quickStartBtn').disabled = true;
    document.getElementById('quickVoteType').value = 'individual';
    document.getElementById('quickVoteTypeInfo').textContent = 'Each player secretly votes, results revealed together';
    // Reset Category Select
    document.getElementById('catPlayerList').innerHTML = '';
    document.getElementById('catImposterCount').textContent = '1';
    document.getElementById('catImposterInfo').textContent = 'Add at least 4 players';
    document.getElementById('catVoteType').value = 'individual';
    document.getElementById('catVoteTypeInfo').textContent = 'Each player secretly votes, results revealed together';
    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('selected'));
    document.getElementById('startCategoryBtn').disabled = true;
    showScreen('homeScreen');
}

// Stats
function loadStats() {
    const stats = JSON.parse(localStorage.getItem('imposterStats')) || { games: 0, crew: 0, imp: 0 };
    document.getElementById('statGames').textContent = stats.games;
    document.getElementById('statCrewWins').textContent = stats.crew;
    document.getElementById('statImpWins').textContent = stats.imp;
    document.getElementById('statRate').textContent = stats.games ? Math.round(stats.crew / stats.games * 100) + '%' : '0%';
}

function updateStats(crewWins) {
    const stats = JSON.parse(localStorage.getItem('imposterStats')) || { games: 0, crew: 0, imp: 0 };
    stats.games++;
    if (crewWins) stats.crew++; else stats.imp++;
    localStorage.setItem('imposterStats', JSON.stringify(stats));
    loadStats();
}

function clearStats() {
    if (confirm('Clear all statistics?')) {
        localStorage.removeItem('imposterStats');
        loadStats();
    }
}

// Init on load
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
